<div class="sim-container">
  <div class="sim-header">
    <div class="progress-container">
      <div class="progress-bar" [style.width.%]="getProgress()"></div>
    </div>
    <div class="score-display">
      <div class="score-icon">ğŸ†</div>
      <div class="score-text">PuntuaciÃ³n: <span class="score-value">{{ score }}</span></div>
    </div>
  </div>

  <div *ngIf="!gameFinished; else results">

    <div class="sim-title">
      <div class="question-counter">
        Pregunta {{ currentQuestionIndex + 1 }} de {{ questions.length }}
      </div>
      <div class="question-text">{{ getCurrentQuestion().question }}</div>
    </div>

    <div class="answers-container">
      <div *ngFor="let option of getCurrentQuestion().options; let i = index"
           class="answer-btn"
           [class.correct]="selectedAnswer !== null && i === getCurrentQuestion().correct"
           [class.incorrect]="selectedAnswer === i && !isCorrect"
           [class.selected]="selectedAnswer === i"
           (click)="selectAnswer(i)">
        {{ option }}
      </div>
    </div>

    <div *ngIf="showExplanation" class="explanation-container">
      <div class="explanation-title">
        <span class="explanation-icon">ğŸ’¡</span> ExplicaciÃ³n
      </div>
      <div class="explanation-text">
        {{ getCurrentQuestion().explanation }}
      </div>
      <button class="next-btn" (click)="nextQuestion()">
        {{ currentQuestionIndex < questions.length - 1 ? 'Siguiente Pregunta' : 'Ver Resultados' }}
        <span class="arrow">â†’</span>
      </button>
    </div>

    <div *ngIf="selectedAnswer !== null && !showExplanation" class="feedback">
      <div *ngIf="isCorrect" class="feedback-correct">
        <span class="feedback-icon">âœ“</span> Â¡Correcto! Â¡Bien hecho!
      </div>
      <div *ngIf="!isCorrect" class="feedback-incorrect">
        <span class="feedback-icon">âœ—</span> Incorrecto. Â¡Revisa la explicaciÃ³n!
      </div>
    </div>
  </div>

  <ng-template #results>
    <div class="results-container">
      <div class="results-header">
        <div class="results-icon">ğŸ‰</div>
        <h2 class="results-title">Â¡Juego Completado!</h2>
        <p class="results-subtitle">AquÃ­ estÃ¡n tus resultados</p>
      </div>

      <div class="score-summary">
        <div class="final-score">
          <div class="final-score-value">{{ score }}</div>
          <div class="final-score-label">PuntuaciÃ³n Final</div>
        </div>

        <div class="percentage-circle">
          <div class="circle-background"></div>
          <div class="circle-progress" [style.transform]="'rotate(' + (getScorePercentage() * 3.6) + 'deg)'"></div>
          <div class="circle-text">{{ getScorePercentage() }}%</div>
        </div>

        <div class="accuracy">
          <div class="accuracy-value">{{ getScorePercentage() }}%</div>
          <div class="accuracy-label">PrecisiÃ³n</div>
        </div>
      </div>

      <div class="level-badge">
        <div class="badge-text">
          <div *ngIf="getScorePercentage() >= 90" class="level-advanced">
             Â¡Excelente! Nivel Avanzado
          </div>
          <div *ngIf="getScorePercentage() >= 70 && getScorePercentage() < 90" class="level-intermediate">
             Â¡Muy Bien! Nivel Intermedio
          </div>
          <div *ngIf="getScorePercentage() >= 50 && getScorePercentage() < 70" class="level-basic">
             Â¡Buen Trabajo! Nivel BÃ¡sico
          </div>
          <div *ngIf="getScorePercentage() < 50" class="level-beginner">
             Â¡Sigue Practicando! Nivel Principiante
          </div>
        </div>
      </div>

      <div class="results-actions">
        <button class="restart-btn" (click)="resetGame()">
          <span class="restart-icon">ğŸ”„</span>
          Jugar Otra Vez
        </button>
      </div>

      <div class="encouragement">
        <p>"Â¡La prÃ¡ctica hace al maestro! Sigue aprendiendo inglÃ©s todos los dÃ­as."</p>
      </div>
    </div>
  </ng-template>
</div>

